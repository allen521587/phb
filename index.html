<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥æœ¬å…è¨±åˆ‡æ›¿ å­¦ç§‘è©¦é¨“å¯¾ç­–</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4A90E2">
    <link rel="apple-touch-icon" href="icon.png">
    
    <style>
        :root {
            --primary: #4A90E2; /* äº¤é€šå®‰å…¨ã®é’ */
            --success: #2ECC71;
            --error: #E74C3C;
            --bg: #F5F7FA;
            --text: #333;
            --card-bg: #FFFFFF;
        }

        * { box-sizing: border-box; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            flex: 1;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆç”¨ */
        .screen { display: none; animation: fadeIn 0.3s ease; }
        .active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            text-align: center;
        }

        h2 { margin-top: 0; font-size: 1.4rem; color: var(--primary); }
        .stats { font-size: 0.9rem; color: #666; margin-bottom: 10px; }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            background: white;
            color: var(--text);
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.1s, background 0.2s;
            border: 2px solid transparent;
        }

        .btn:active { transform: scale(0.98); }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: transparent; }
        
        /* é¸æŠè‚¢ãƒœã‚¿ãƒ³ */
        .option-btn { text-align: left; padding-left: 20px; }
        .option-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .option-btn.wrong { background: var(--error); color: white; border-color: var(--error); }
        .option-btn:disabled { cursor: default; opacity: 0.8; }

        /* ç”»åƒã‚¨ãƒªã‚¢ */
        .q-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ddd;
            display: none; /* ç”»åƒãŒãªã„å ´åˆã¯éè¡¨ç¤º */
        }
        .q-image.show { display: block; }

        /* è§£èª¬ã‚¨ãƒªã‚¢ */
        #explanation-area {
            background: #E8F6F3;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: left;
            display: none;
            border-left: 5px solid var(--success);
        }

        /* æ¨¡æ“¬è©¦é¨“ã‚¿ã‚¤ãƒãƒ¼ */
        #timer {
            font-family: monospace;
            font-size: 1.2rem;
            color: var(--error);
            font-weight: bold;
            text-align: right;
            margin-bottom: 10px;
            display: none;
        }

        /* çµæœç”»é¢ */
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 20px;
        }
        .pass { background: var(--success); }
        .fail { background: var(--error); }

    </style>
</head>
<body>

<header>å…è¨±åˆ‡æ›¿ å­¦ç§‘å¯¾ç­–</header>

<div class="container">
    
    <div id="home-screen" class="screen active">
        <div class="card">
            <h2>å­¦ç¿’ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
            <p>ä¸­å›½å…è¨±ã‹ã‚‰ã®åˆ‡æ›¿è©¦é¨“å¯¾ç­–</p>
            <div class="stats" id="mistake-count">ç¾åœ¨ 0 å•ã®è¦å¾©ç¿’å•é¡ŒãŒã‚ã‚Šã¾ã™</div>
        </div>

        <button class="btn btn-primary" onclick="startQuiz('practice')">ğŸ”° ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ (å…¨å•)</button>
        <button class="btn btn-primary" style="background:#E67E22" onclick="startQuiz('exam')">ğŸ”¥ æ¨¡æ“¬è©¦é¨“ (50å•/åˆ¶é™ã‚ã‚Š)</button>
        <button class="btn btn-outline" onclick="startQuiz('review')" id="review-btn" disabled>ğŸ“ å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ (é–“é•ãˆãŸå•é¡Œ)</button>
        
        <div style="margin-top:30px; font-size:0.8rem; color:#999; text-align:center;">
            Ver 1.0 | Offline Ready
        </div>
    </div>

    <div id="quiz-screen" class="screen">
        <div id="timer">45:00</div>
        <div class="progress-text" style="text-align:right; font-size:0.9rem; color:#666; margin-bottom:5px;">
            <span id="current-q-num">1</span> / <span id="total-q-num">10</span>
        </div>
        
        <div class="card">
            <h3 id="question-text" style="font-size:1.1rem; margin-bottom:15px;">ã“ã“ã«å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œã¾ã™</h3>
            <img id="question-image" src="" class="q-image" alt="å•é¡Œç”»åƒ">
            
            <div id="options-container">
                </div>

            <div id="explanation-area">
                <strong>è§£èª¬:</strong>
                <p id="explanation-text"></p>
                <button class="btn btn-primary" onclick="nextQuestion()" style="margin-top:10px;">æ¬¡ã¸é€²ã‚€</button>
            </div>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <div class="card">
            <div id="score-badge" class="score-circle">80%</div>
            <h2 id="result-title">åˆæ ¼ï¼</h2>
            <p id="result-detail">æ­£è§£: 45 / 50</p>
            <p id="result-message"></p>
        </div>
        <button class="btn btn-primary" onclick="goHome()">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
        <button class="btn btn-outline" onclick="startQuiz('review')">é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’ã™ã‚‹</button>
    </div>

</div>

<script>
    // --- 1. ãƒ‡ãƒ¼ã‚¿å®šç¾© (ã“ã“ã«500å•è¿½åŠ ã—ã¦ã„ãã¾ã™) ---
    // type: 1=â—‹Ã—, 2=äºŒæŠ, 3=ä¸‰æŠ
    // image: ç”»åƒURL (ãªã‘ã‚Œã° null)
    const allQuestions = [
        {
            id: 1,
            type: 1,
            question: "ä¿¡å·æ©Ÿã®ã‚ã‚‹äº¤å·®ç‚¹ã§ã€ä¿¡å·ãŒã€Œèµ¤è‰²ã®ç‚¹æ»…ã€ã‚’ã—ã¦ã„ã‚‹å ´åˆã€è»Šã¯å¾è¡Œã—ã¦é€šè¡Œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚",
            image: null,
            options: ["â—‹", "Ã—"],
            answer: 1, // index of options (0 is â—‹, 1 is Ã—)
            explanation: "èµ¤è‰²ã®ç‚¹æ»…ã¯ã€Œä¸€æ™‚åœæ­¢ã€ãŒå¿…è¦ã§ã™ã€‚å¾è¡Œã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚"
        },
        {
            id: 2,
            type: 1,
            question: "ã€Œæ­¢ã¾ã‚Œã€ã®æ¨™è­˜ãŒã‚ã‚‹å ´æ‰€ã§ã¯ã€åœæ­¢ç·šã®ç›´å‰ã§ä¸€æ™‚åœæ­¢ã—ã€å·¦å³ã®å®‰å…¨ã‚’ç¢ºèªã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚",
            image: "", // å®Ÿéš›ã®URLã‚’å…¥ã‚Œã¦ãã ã•ã„
            options: ["â—‹", "Ã—"],
            answer: 0,
            explanation: "ãã®é€šã‚Šã§ã™ã€‚è»Šè¼ªã‚’å®Œå…¨ã«åœæ­¢ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚"
        },
        {
            id: 3,
            type: 2,
            question: "æ¬¡ã®æ¨™è­˜ã®æ„å‘³ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
            image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/Japan_road_sign_302.svg/120px-Japan_road_sign_302.svg.png", // è»Šä¸¡é€²å…¥ç¦æ­¢
            options: ["è»Šä¸¡é€²å…¥ç¦æ­¢", "é§è»Šç¦æ­¢"],
            answer: 0,
            explanation: "ã“ã‚Œã¯ã€Œè»Šä¸¡é€²å…¥ç¦æ­¢ã€ã®æ¨™è­˜ã§ã™ã€‚ä¸€æ–¹é€šè¡Œã®å‡ºå£ãªã©ã«è¦‹ã‚‰ã‚Œã¾ã™ã€‚"
        },
        {
            id: 4,
            type: 3,
            question: "å¤œé–“ã€å¯¾å‘è»Šã¨è¡Œãé•ã†ã¨ãã€ãƒ˜ãƒƒãƒ‰ãƒ©ã‚¤ãƒˆã¯ã©ã†ã™ã‚‹ã¹ãã§ã™ã‹ï¼Ÿ",
            image: null,
            options: ["ãƒã‚¤ãƒ“ãƒ¼ãƒ ï¼ˆä¸Šå‘ãï¼‰ã®ã¾ã¾ã«ã™ã‚‹", "ãƒ­ãƒ¼ãƒ“ãƒ¼ãƒ ï¼ˆä¸‹å‘ãï¼‰ã«åˆ‡ã‚Šæ›¿ãˆã‚‹", "ãƒ©ã‚¤ãƒˆã‚’æ¶ˆã™"],
            answer: 1,
            explanation: "å¯¾å‘è»Šã‚„å‰èµ°è»ŠãŒã„ã‚‹å ´åˆã¯ã€ç›¸æ‰‹ãŒã¾ã¶ã—ããªã„ã‚ˆã†ã«ãƒ­ãƒ¼ãƒ“ãƒ¼ãƒ ï¼ˆä¸‹å‘ãï¼‰ã«ã—ã¾ã™ã€‚"
        },
        {
            id: 5,
            type: 1,
            question: "è¿½ã„è¶Šã—ã‚’ã™ã‚‹å ´åˆã€åŸå‰‡ã¨ã—ã¦å‰è»Šã®å·¦å´ã‚’é€šè¡Œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚",
            image: null,
            options: ["â—‹", "Ã—"],
            answer: 1,
            explanation: "æ—¥æœ¬ã®é“è·¯ã§ã¯ã€è¿½ã„è¶Šã—ã¯åŸå‰‡ã¨ã—ã¦ã€Œå³å´ã€ã‚’é€šè¡Œã—ã¦è¡Œã„ã¾ã™ã€‚"
        },
        // ... ã“ã“ã«å•é¡Œã‚’è¿½åŠ ã—ã¦ã„ã ...
    ];

    // --- 2. å¤‰æ•°ç®¡ç† ---
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let currentMode = 'practice'; // practice, exam, review
    let wrongQuestions = JSON.parse(localStorage.getItem('myWrongQuestions')) || [];
    let timerInterval;

    // --- 3. åˆæœŸåŒ–å‡¦ç† ---
    window.onload = function() {
        updateMistakeCount();
    };

    function updateMistakeCount() {
        const count = wrongQuestions.length;
        document.getElementById('mistake-count').innerText = `ç¾åœ¨ ${count} å•ã®è¦å¾©ç¿’å•é¡ŒãŒã‚ã‚Šã¾ã™`;
        document.getElementById('review-btn').disabled = count === 0;
    }

    // --- 4. ã‚¯ã‚¤ã‚ºé–‹å§‹å‡¦ç† ---
    function startQuiz(mode) {
        currentMode = mode;
        score = 0;
        currentQuestionIndex = 0;

        // ãƒ¢ãƒ¼ãƒ‰åˆ¥å•é¡Œã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        if (mode === 'practice') {
            currentQuestions = [...allQuestions].sort(() => Math.random() - 0.5);
            document.getElementById('timer').style.display = 'none';
        } else if (mode === 'exam') {
            // å…¨å•é¡Œã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«50å•æŠ½å‡ºï¼ˆå•é¡Œæ•°ãŒè¶³ã‚Šãªã„å ´åˆã¯å…¨å•ï¼‰
            const shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
            currentQuestions = shuffled.slice(0, Math.min(50, shuffled.length));
            startTimer(45 * 60); // 45åˆ† (ç§’)
            document.getElementById('timer').style.display = 'block';
        } else if (mode === 'review') {
            // é–“é•ãˆãŸå•é¡ŒIDã«ä¸€è‡´ã™ã‚‹å•é¡Œã‚’æŠ½å‡º
            currentQuestions = allQuestions.filter(q => wrongQuestions.includes(q.id));
            if (currentQuestions.length === 0) return alert("å¾©ç¿’ã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ï¼");
            currentQuestions.sort(() => Math.random() - 0.5);
            document.getElementById('timer').style.display = 'none';
        }

        switchScreen('quiz-screen');
        renderQuestion();
    }

    // --- 5. å•é¡Œè¡¨ç¤ºå‡¦ç† ---
    function renderQuestion() {
        const q = currentQuestions[currentQuestionIndex];
        
        // é€²æ—è¡¨ç¤º
        document.getElementById('current-q-num').innerText = currentQuestionIndex + 1;
        document.getElementById('total-q-num').innerText = currentQuestions.length;

        // å•é¡Œæ–‡ã¨ç”»åƒ
        document.getElementById('question-text').innerText = q.question;
        const imgEl = document.getElementById('question-image');
        if (q.image && !q.image.includes("[Image")) { // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼é™¤å¤–å‡¦ç†
            imgEl.src = q.image;
            imgEl.classList.add('show');
        } else {
            imgEl.classList.remove('show');
        }

        // é¸æŠè‚¢ç”Ÿæˆ
        const optsContainer = document.getElementById('options-container');
        optsContainer.innerHTML = '';
        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'btn option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optsContainer.appendChild(btn);
        });

        // è§£èª¬ã‚¨ãƒªã‚¢ã‚’éš ã™
        document.getElementById('explanation-area').style.display = 'none';
    }

    // --- 6. å›ç­”åˆ¤å®šå‡¦ç† ---
    function checkAnswer(selectedIndex, btnElement) {
        const q = currentQuestions[currentQuestionIndex];
        const isCorrect = (selectedIndex === q.answer);
        const allBtns = document.querySelectorAll('.option-btn');

        // ãƒœã‚¿ãƒ³ã®ç„¡åŠ¹åŒ–
        allBtns.forEach(b => b.disabled = true);

        if (isCorrect) {
            score++;
            btnElement.classList.add('correct');
            // æ­£è§£ã®å ´åˆã¯ã€Œé–“é•ã„ãƒªã‚¹ãƒˆã€ã‹ã‚‰å‰Šé™¤
            wrongQuestions = wrongQuestions.filter(id => id !== q.id);
        } else {
            btnElement.classList.add('wrong');
            // æ­£è§£ã®ãƒœã‚¿ãƒ³ã‚’ç·‘ã«ã™ã‚‹
            allBtns[q.answer].classList.add('correct');
            // ä¸æ­£è§£ã®å ´åˆã¯ã€Œé–“é•ã„ãƒªã‚¹ãƒˆã€ã«è¿½åŠ ï¼ˆé‡è¤‡ãªã—ï¼‰
            if (!wrongQuestions.includes(q.id)) {
                wrongQuestions.push(q.id);
            }
        }
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ›´æ–°
        localStorage.setItem('myWrongQuestions', JSON.stringify(wrongQuestions));

        // æ¨¡æ“¬è©¦é¨“ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ã€å³åº§ã«æ¬¡ã¸è¡Œã‹ãšè§£èª¬ã‚’è¡¨ç¤ºã™ã‚‹ã‹ï¼Ÿ
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã€Œå³æ™‚ã«æ­£è§£è¡¨ç¤ºã€ã«å¾“ã†
        showExplanation(q.explanation);
    }

    function showExplanation(text) {
        const area = document.getElementById('explanation-area');
        document.getElementById('explanation-text').innerText = text;
        area.style.display = 'block';
        area.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuestions.length) {
            renderQuestion();
        } else {
            finishQuiz();
        }
    }

    // --- 7. çµ‚äº†å‡¦ç† ---
    function finishQuiz() {
        if (timerInterval) clearInterval(timerInterval);
        
        switchScreen('result-screen');
        
        const percentage = Math.round((score / currentQuestions.length) * 100);
        const badge = document.getElementById('score-badge');
        const title = document.getElementById('result-title');
        const msg = document.getElementById('result-message');
        
        badge.innerText = `${percentage}%`;
        document.getElementById('result-detail').innerText = `æ­£è§£: ${score} / ${currentQuestions.length}`;

        if (percentage >= 90) {
            badge.className = 'score-circle pass';
            title.innerText = 'åˆæ ¼ï¼ğŸ‰';
            title.style.color = 'var(--success)';
            msg.innerText = 'ç´ æ™´ã‚‰ã—ã„æˆç¸¾ã§ã™ï¼ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚';
        } else {
            badge.className = 'score-circle fail';
            title.innerText = 'ä¸åˆæ ¼...';
            title.style.color = 'var(--error)';
            msg.innerText = '90%ä»¥ä¸Šã§åˆæ ¼ã§ã™ã€‚é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’ã—ã¾ã—ã‚‡ã†ã€‚';
        }

        updateMistakeCount();
    }

    function goHome() {
        switchScreen('home-screen');
    }

    // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---
    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
    }

    function startTimer(seconds) {
        const timerEl = document.getElementById('timer');
        let remaining = seconds;
        
        if (timerInterval) clearInterval(timerInterval);
        
        timerInterval = setInterval(() => {
            remaining--;
            const m = Math.floor(remaining / 60);
            const s = remaining % 60;
            timerEl.innerText = `${m}:${s.toString().padStart(2, '0')}`;
            
            if (remaining <= 0) {
                clearInterval(timerInterval);
                alert("æ™‚é–“åˆ‡ã‚Œã§ã™ï¼");
                finishQuiz();
            }
        }, 1000);
    }
</script>

</body>
</html>
